# 04 아키텍처 #

MySQL 서버는 사람의 머리 역할을 담당하는 MySQL 엔진과 손발 역할을 담당하는 스토리지 엔진으로 구분할 수 있다. 스토리지 엔진은 핸들러 API를 만족하면 누구든지 스토리지 엔진을 구현해서 MySQL 서버에 추가해서 사용할 수 있다.

## 4.1 MySQL 엔진 아키텍처 ##

MySQL 서버는 크게 MySQL 엔진과 스토리지 엔진으로 구분할 수 있다.

### 4.1.1.1 MySQL 엔진 ###
MySQL 엔진은 클라이언트로부터의 접속 및 쿼리 요청을 처리하는 커넥션 핸들러와 SQL 파서 및 전처리기, 쿼리의 최적화된 실행을 위한 옵티마이저가 중심을 이룬다. 또한 mysql은 표준 sql 문법을 지원하기 때문에 표준 문법에 따라 작성된 쿼리는 타 DBMS와 호환되어 실행될 수 있다

### 4.1.1.2 스토리지 엔진 ###

MySQL 엔진은 요청된 SQL 문장을 분석하거나 최적화 하는 등 DBMS 의 두뇌에 해당하는 처리를 수행하고 실제 데이터를 디스크 스토리지에 저장하거나 디스크 스토리지로부터 데이터를 읽어오는 부분은 스토리지 엔진이 전담한다. MySQL 서버에서 MySQL 엔진은 하나이지만 MySQL 스토리지 엔진은 여러개를 사용할 수 있다. 각 스토리지 엔진은 성능향상을 위해 MyISAM 스토리지 엔진은 키 캐시, InnoDB 엔진은 InnoDB 버퍼풀같은 기능을 제공한다.

### 4.1.1.3 핸들러 API ###

MySQL 엔진의 쿼리 실행기에서 데이터를 쓰거나 읽어야 할 때는 각 스토리지 엔진에 쓰기 또는 읽기를 요청하는데, 이러한 요청을 핸들러 요청이라고 하고 여기서 사용되는 api를 핸들러 api 라고 한다. InnoDB 스토리지 엔진 또한 이 핸들러 API 를 이용해 MySQL 엔진과 데이터를 주고받는다. 이 핸들러 API를 통해 얼마나 많은 데이터 작업이 있었는지는 
``` SQL
SHOW GLOBAL STATUS LIKE 'Handler%'; 
```
명령어로 확인이 가능하다

### 4.1.2 MySQL 스레딩 구조 ###

MySQL 서버는 프로세스 기반이 아니라 스레드 기반으로 동작하며 크게 Foreground, background 서버로 구분할 수 있다. 백그라운드 스레드의 개수는 MySQL 서버의 설정에 따라 바뀔 수 있다. 동일한 이름의 스레드가 2개 이상인 경우는 여러 스레드가 동일 작업을 병렬로 수행하는 것이다.

### 4.1.2.1 포그라운드 스레드(클라이언트 스레드) ###

포그라운드 스레드는 MySQL 서버에 접속된 클라이언트의 수 만큼 존재하며 주로 각 클라이언트가 요청하는 쿼리 문장을 처리한다. 클라이언트 사용자가 작업을 마치고 커넥션을 종료하면 커넥션을 담당하던 스레드는 스레드 캐시로 돌아간다. 단 스레드 캐시가 일정 이상 차있다면 스레드 캐시에 넣지 않고 종료시킨다. 스레드 캐시에 유지할 수 있는 최대 스레드 개수는 thread_cache_size 시스템 변수로 설정한다.

포그라운드 스레드는 데이터를 MySQL 데이터 버퍼나 캐시로부터 가져오며 버퍼나 캐시에 없으면 직접 디스크의 데이터나 인덱스 파일로부터 데이터를 불러와서 작업을 처리한다. MyISAM 테이블은 디스크 쓰기 작업까지 포그라운드 스레드에서 처리한다. InnoDB 테이블은 데이터 버퍼나 캐시까지만 포그라운드에서 처리하고 버퍼로부터 디스크로 기록하는 작업은 백그라운드 스레드가 처리한다.

### 4.1.2.2 백그라운드 스레드 ###

